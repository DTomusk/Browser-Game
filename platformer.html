<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<canvas id="canvas" width="1200" height="800"></canvas>

	<script type="text/javascript">
		var canvas;
		var ctx; 
		var fps = 24;
		// when in the air vy of any object increases by 0.5 every frame
		var g = 0.5

		// load all objects into the scene and stuff
		window.onload = function() {
			canvas = document.getElementById('canvas');
			ctx = canvas.getContext('2d');

			// initial objects, should be in its own place
			var tree = new Oak(70, 70);
			var player = new Actor(100, 100, 20, 20, "grey");

			var level = new Level(400, 600, [], 
				[new Object(0, 500, 400, 100, "blue", true)],[tree],[player])
			
			setInterval(function() {
				moveStuff(level);
				drawStuff(level);
			}, 1000/fps);

			window.addEventListener("keydown", function(evt) {
				switch(evt.keyCode) {
					case 37:
						player.vx = -5;
						break;
					case 39:
						player.vx = 5;
						break;
				}
			});

			window.addEventListener("keyup", function(evt) {
				switch(evt.keyCode) {
					case 37:
						player.vx = 0;
						break;
					case 39:
						player.vx = 0;
						break;
				}
			})
		}

		function moveStuff(level) {

			level.actors.forEach(actor => {
				checkCollision(actor, level);
				// update position
				actor.x += actor.vx;
				actor.y += actor.vy;
				// needs to be changed so relative to midground objects, not canvas boundary
				if (actor.y + actor.height < canvas.height) {
					actor.vy += g;
				} 
			})
		}

		function checkCollision(actor, level) {
			// currently assumes collision from above 
			// only works out collision between actors and midground objects
			level.midground.forEach(object => {
				if (object.x < actor.x + actor.width &&
   						object.x + object.width > actor.x &&
   						object.y < actor.y + actor.height &&
   						object.y + object.height > actor.y) {
						//actor.vx = 0;
						actor.vy = 0;
						actor.y = object.y - actor.height;
					};
			})

			// canvas boundary collision
			if (actor.x < 0) {
				actor.x = 0;
				actor.vx = 0;
			};
			if (actor.x + actor.width > canvas.width) {
				actor.x = canvas.width - actor.width;
				actor.vx = 0;
			};
			if (actor.y < 0) {
				actor.y = 0;
				actor.vy = 0;
			};
			if (actor.y + actor.height > canvas.height) {
				actor.y = canvas.height - actor.height;
				actor.vy = 0;
			};
		}

		function drawStuff(level) {
			drawBG();
			level.background.forEach(element => element.draw())
			level.actors.forEach(actor => actor.draw())
			level.midground.forEach(element => element.draw())
			level.foreground.forEach(element => element.draw())
		}

		function drawBG() {
			ctx.fillStyle = "black";
			ctx.fillRect(0,0,canvas.width,canvas.height);
		}
	</script>
	<script type="text/javascript" src="level.js"></script>

</body>
</html>